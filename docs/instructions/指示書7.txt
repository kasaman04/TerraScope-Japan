ğŸ›°â€¯Stepâ€¯8â€¯â€”â€¯Sanityâ€¯â†’â€¯GitHubÂ Actions è‡ªå‹•å†ãƒ“ãƒ«ãƒ‰ Webhook
ã‚´ãƒ¼ãƒ«â€¯: Studio ã§ â€œPublishâ€ ã‚’æŠ¼ã™ãŸã³ã« GitHubÂ Pages ãŒå†ãƒ“ãƒ«ãƒ‰ï¼†å†ãƒ‡ãƒ—ãƒ­ã‚¤
ï¼ˆæ–°ã—ã„è¨˜äº‹ãƒ»FAQãƒ»ã‚µãƒ¼ãƒ“ã‚¹ã‚’è¿½åŠ ã—ã¦ã‚‚æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤ä¸è¦ã«ï¼‰

1. GitHub Personal Access Token (PAT)
GitHub â–¸ Settings â–¸ Developer settings â–¸ PATs (Fineâ€‘grained)

Repository accessâ€¯â†’â€¯Only select repositories â†’ é¸æŠ

Permissions

Actions: Read & Write

Contents: Read & Write (dispatch endpointå†…éƒ¨ã§å¿…è¦)

Generate token â†’ ã‚³ãƒ”ãƒ¼ï¼ˆghp_xxxxxxxxxï¼‰

2. æ–°ã—ã„ GitHubâ€¯Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ (dispatch)
.github/workflows/dispatch-deploy.yml

yaml
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
name: Manual Redeploy via API
on:
  repository_dispatch:
    types: [sanity-publish]

jobs:
  redeploy:
    uses: ./.github/workflows/deploy.yml   # æ—¢å­˜ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å†åˆ©ç”¨
    secrets: inherit
æ—¢ã« mainâ†’deploy.yml ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒã‚ã‚‹ã®ã§ã€
repository_dispatch ã§åŒã˜ build ã‚¹ãƒ†ãƒƒãƒ—ã‚’å†åˆ©ç”¨ã—ã¾ã™ã€‚

3. Sanity Webhook è¨­å®š
Sanity Studio â–¸ Project settings â–¸ API â–¸ Webhooks â–¸ + New

Trigger onâ€¯â†’ document.publish

URL

bash
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
https://api.github.com/repos/<USER>/<REPO>/dispatches
HTTP methodâ€¯â†’ POST

Headers

Authorization: token YOUR_GH_PAT

Accept: application/vnd.github+json

Payload (Body)

json
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
{
  "event_type": "sanity-publish"
}
Filterâ€¯(ä»»æ„)

Type: include -> posts, caseStudy, faq, service, team

4. ãƒ†ã‚¹ãƒˆ
Studio ã§ä»»æ„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ Publish

GitHub â–¸ Actions â†’ Manual Redeploy via API ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒèµ°ã‚‹

å®Œäº†å¾Œ Pages URL ã§ Ctrl+F5 â†’ åæ˜ ã‚’ç¢ºèª

/services/ ã«æ–°ã‚µãƒ¼ãƒ“ã‚¹ãŒå‡ºã‚‹ãªã©

5. å®‰å…¨å¯¾ç­–
ãƒªã‚¹ã‚¯	å¯¾ç­–
PAT éœ²å‡º	ã‚¹ã‚³ãƒ¼ãƒ—æœ€å° (1â€¯repo) + Expiration 90â€¯d
ãƒ“ãƒ«ãƒ‰é »åº¦éå¤š	Webhook filterã§ doc type ã‚’çµã‚‹ / Draft Save ã¯ãƒˆãƒªã‚¬ã—ãªã„

6. å®Œäº†ãƒã‚§ãƒƒã‚¯
 repository_dispatch ãŒæˆåŠŸãƒ­ã‚° (â€œtriggered via sanityâ€‘publishâ€)

 ãƒšãƒ¼ã‚¸ãŒæ›´æ–°ï¼ˆã‚µã‚¤ãƒˆã«æ–°è¨˜äº‹ç­‰ãŒå‡ºç¾ï¼‰

 No manual push needed

çµ‚ã‚ã£ãŸã‚‰ã€ŒWebhook OKã€ ã¨ã ã‘è¿”ä¿¡ã—ã¦ãã ã•ã„ã€‚
ç¢ºèªå¾Œã€Stepâ€¯9â€¯â€”â€¯GA4 è¨­å®š & Cookie Consent ãƒãƒŠãƒ¼ ã‚’ã‚¬ã‚¤ãƒ‰ã—ã¾ã™ã€‚