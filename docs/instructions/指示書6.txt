ğŸâ€¯Stepâ€¯7â€¯â€”â€¯GitHubâ€¯PagesÂ CI/CD
ç›®æ¨™â€¯: git push â†’ GitHubÂ Actions â†’ ghâ€‘pages ãƒ–ãƒ©ãƒ³ãƒã«é™çš„ã‚µã‚¤ãƒˆãŒè‡ªå‹•å…¬é–‹
ï¼ˆCloudflareâ€¯Workerã¨ Sanity ã¯æ—¢ã«å¤–éƒ¨ã«ã‚ã‚‹ã®ã§ã€Pages ã«ç½®ãã®ã¯ ç´”ç²‹ãª dist/ ã ã‘ã§ã™ï¼‰

1. ãƒªãƒã‚¸ãƒˆãƒªæº–å‚™
bash
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
git init
git remote add origin https://github.com/<USER>/<REPO>.git
git add .
git commit -m "init"
git push -u origin main
astro.config.mjs ã¯ã‚‚ã† base/site è¨­å®šæ¸ˆã¿
js
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
base: "/<REPO>",
site: "https://<USER>.github.io/<REPO>",
2. GitHubÂ Pages è¨­å®š
Settings â–¸ Pages

BuildÂ &Â Deploy: GitHubÂ Actions

Branch: ç©ºæ¬„ï¼ˆActions ãŒ gh-pages ã‚’è‡ªå‹•ä½œæˆï¼‰

Custom Domain ã‚’ä½¿ã†å ´åˆã¯å¾Œã§ CNAME ã‚’è¿½åŠ 

3. Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
.github/workflows/deploy.yml

yaml
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
name: CI & Deploy to GitHub Pages

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  build:
    permissions:
      contents: read
      pages: write      # allow gh-pages push
      id-token: write   # allow OIDC for Pages
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - uses: pnpm/action-setup@v2
        with: { version: 9 }
      - run: pnpm install --frozen-lockfile

      - run: pnpm run build
        env:
          PUBLIC_SANITY_PROJECT_ID: ${{ secrets.SANITY_PROJECT_ID }}
          PUBLIC_SANITY_DATASET: ${{ secrets.SANITY_DATASET }}
          PUBLIC_SANITY_API_VERSION: "2025-07-15"

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with: { path: "./dist" }

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
Secrets ã«å…¥ã‚Œã‚‹ã®ã¯ READ å°‚ç”¨ (SANITY_PROJECT_ID ãªã©)ã€‚
Cloudflare Worker ã® writeâ€‘tokenã¯ Pages ã«ã¯ä¸è¦ã§ã™ã€‚

4. Secrets ç™»éŒ²
Settings â–¸ Secretsâ€¯â†’â€¯Actions

Name	Value
SANITY_PROJECT_ID	xxxxxxx
SANITY_DATASET	production

5. åˆå›ãƒ“ãƒ«ãƒ‰ & å…¬é–‹ç¢ºèª
bash
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
git push
# â†’ Actions ãŒèµ°ã‚‹
Actions ã‚¿ãƒ–ï¼šãƒ‡ãƒ—ãƒ­ã‚¤æˆåŠŸ (â€œDeployed to ghâ€‘pagesâ€)

Pages URLï¼šhttps://<USER>.github.io/<REPO>/ ã§ã‚µã‚¤ãƒˆè¡¨ç¤º

ãƒ‘ã‚¹ãƒ™ãƒ¼ã‚¹å¤šè¨€èªã‚‚å‹•ãã‹ç¢ºèª

/zh/services/ã€/ko/about/ ãªã©

6. 404 ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆsingleâ€‘page å¯¾å¿œï¼‰
GitHubÂ Pages ã§ã¯ 404.html ã«ãƒˆãƒƒãƒ—ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’ç½®ãã¨ SPA ã§ã‚‚ç ´ç¶»ã—ãªã„ã€‚
astro.config.mjs build adapterã¯è‡ªå‹•ã§ 404 ã‚’åãã®ã§è¿½åŠ ä½œæ¥­ä¸è¦ã€‚

7. PullÂ Request Preview (ä»»æ„)
deploy.yml ã«

yaml
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
on:
  pull_request:
    branches: [main]
ï¼‹ actions/deploy-pages ã® preview: true ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§
PR ã”ã¨ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ URL ãŒç”Ÿæˆã§ãã‚‹ã€‚

8. å®Œäº†ãƒã‚§ãƒƒã‚¯
 Actions ãŒç·‘

 ghâ€‘pages ãƒ–ãƒ©ãƒ³ãƒãŒè‡ªå‹•ç”Ÿæˆ

 sitemap-index.xml ãŒå…¬é–‹ URL ã§é–‹ã‘ã‚‹

 /contact ãƒ•ã‚©ãƒ¼ãƒ  â†’ Worker â†’ Sanity ã¾ã§æœ¬ç•ª URL ã§å‹•ã

 Multiâ€‘lang (/ja/, /zh/) ãŒ 200

ã“ã‚ŒãŒæ¸ˆã‚“ã ã‚‰ã€ŒPages ãƒ‡ãƒ—ãƒ­ã‚¤ OKã€ã¨ä¼ãˆã¦ãã ã•ã„ã€‚
æ¬¡ã¯ Stepâ€¯8Â â€”Â Sanity Publish â†’ GitHub Actions å†ãƒ“ãƒ«ãƒ‰ Webhook ã‚’æ¡ˆå†…ã—ã¾ã™ã€‚