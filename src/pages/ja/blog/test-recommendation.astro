---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import LazyImage from '../../../components/LazyImage.astro';

const title = "æ—¥æœ¬ã§æš®ã‚‰ã™ - åœ°åŸŸåˆ¥ç”Ÿæ´»æƒ…å ±ã‚¬ã‚¤ãƒ‰ï¼ˆãƒ†ã‚¹ãƒˆç‰ˆï¼‰";
const description = "å¤–å›½äººãŒæ—¥æœ¬ã§æš®ã‚‰ã™ã“ã¨ã‚’æ¤œè¨ã™ã‚‹éš›ã®ã€åœ°åŸŸã”ã¨ã®ç”Ÿæ´»è¦–ç‚¹æƒ…å ±ã‚’æä¾›ã€‚é˜²ç½ã€ã‚¤ãƒ³ãƒ•ãƒ©ã€ç”Ÿæ´»ã‚³ã‚¹ãƒˆã€å†é–‹ç™ºã€æ³•åˆ¶åº¦ãªã©ã‚’è©³ã—ãè§£èª¬ã€‚";
const lang = "ja";

// å¸‚åŒºç”ºæ‘ãƒ‡ãƒ¼ã‚¿ã«å±æ€§ã‚’è¿½åŠ 
const citiesData = [
  // åŒ—æµ·é“
  {
    name: "æœ­å¹Œå¸‚",
    prefecture: "åŒ—æµ·é“",
    prefectureSlug: "hokkaido",
    citySlug: "sapporo",
    image: `${import.meta.env.BASE_URL}assets/images/prefectures/hokkaido.png`,
    attributes: {
      budget: ["high"], // low, medium, high
      climate: ["cold", "snow"], // warm, moderate, cold, snow
      environment: ["large-city"], // large-city, medium-city, nature-rich
      international: ["foreign-community", "multilingual-medical", "international-school"],
      access: ["airport-close", "public-transport"]
    },
    description: "åŒ—æµ·é“ã®ä¸­å¿ƒéƒ½å¸‚ã€‚é›ªã¯å¤šã„ãŒéƒ½å¸‚æ©Ÿèƒ½å……å®Ÿ"
  },
  {
    name: "å‡½é¤¨å¸‚",
    prefecture: "åŒ—æµ·é“", 
    prefectureSlug: "hokkaido",
    citySlug: "hakodate",
    image: `${import.meta.env.BASE_URL}assets/images/prefectures/hokkaido.png`,
    attributes: {
      budget: ["medium"],
      climate: ["cold", "snow"],
      environment: ["medium-city", "nature-rich"],
      international: ["multilingual-medical"],
      access: ["airport-close"]
    },
    description: "æ­´å²ã‚ã‚‹æ¸¯ç”ºã€‚è¦³å…‰æ¥­ãŒç››ã‚“"
  },
  
  // æ±äº¬éƒ½
  {
    name: "æ¸‹è°·åŒº",
    prefecture: "æ±äº¬éƒ½",
    prefectureSlug: "tokyo",
    citySlug: "shibuya",
    image: `${import.meta.env.BASE_URL}assets/images/prefectures/tokyo.png`,
    attributes: {
      budget: ["high"],
      climate: ["moderate"],
      environment: ["large-city"],
      international: ["foreign-community", "multilingual-medical", "international-school"],
      access: ["airport-close", "tokyo-access", "public-transport"]
    },
    description: "æ±äº¬ã®ä¸­å¿ƒåœ°ã€‚å›½éš›çš„ã§ä¾¿åˆ©ã ãŒå®¶è³ƒã¯é«˜ã„"
  },
  {
    name: "å…«ç‹å­å¸‚",
    prefecture: "æ±äº¬éƒ½",
    prefectureSlug: "tokyo",
    citySlug: "hachioji",
    image: `${import.meta.env.BASE_URL}assets/images/prefectures/tokyo.png`,
    attributes: {
      budget: ["medium"],
      climate: ["moderate"],
      environment: ["medium-city", "nature-rich"],
      international: ["multilingual-medical"],
      access: ["tokyo-access", "public-transport"]
    },
    description: "æ±äº¬è¥¿éƒ¨ã®è‡ªç„¶è±Šã‹ãªåœ°åŸŸã€‚éƒ½å¿ƒã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚‚è‰¯å¥½"
  },
  
  // å¤§é˜ªåºœ
  {
    name: "å¤§é˜ªå¸‚",
    prefecture: "å¤§é˜ªåºœ",
    prefectureSlug: "osaka",
    citySlug: "osaka",
    image: `${import.meta.env.BASE_URL}assets/images/prefectures/osaka.png`,
    attributes: {
      budget: ["medium", "high"],
      climate: ["warm"],
      environment: ["large-city"],
      international: ["foreign-community", "multilingual-medical", "international-school"],
      access: ["airport-close", "public-transport"]
    },
    description: "è¥¿æ—¥æœ¬ã®ä¸­å¿ƒéƒ½å¸‚ã€‚æ´»æ°—ãŒã‚ã‚Šå¤–å›½äººã‚‚å¤šã„"
  },
  
  // ç¦å²¡çœŒ
  {
    name: "ç¦å²¡å¸‚",
    prefecture: "ç¦å²¡çœŒ",
    prefectureSlug: "fukuoka",
    citySlug: "fukuoka",
    image: `${import.meta.env.BASE_URL}assets/images/prefectures/fukuoka.png`,
    attributes: {
      budget: ["medium"],
      climate: ["warm"],
      environment: ["large-city"],
      international: ["foreign-community", "multilingual-medical"],
      access: ["airport-close", "public-transport"]
    },
    description: "ã‚¢ã‚¸ã‚¢ã«è¿‘ã„ä¹å·ã®ç„é–¢å£ã€‚ä½ã¿ã‚„ã™ã„éƒ½å¸‚"
  },
  
  // æ²–ç¸„çœŒ
  {
    name: "é‚£è¦‡å¸‚",
    prefecture: "æ²–ç¸„çœŒ",
    prefectureSlug: "okinawa",
    citySlug: "naha",
    image: `${import.meta.env.BASE_URL}assets/images/prefectures/okinawa.png`,
    attributes: {
      budget: ["medium"],
      climate: ["warm"],
      environment: ["medium-city", "nature-rich"],
      international: ["foreign-community"],
      access: ["airport-close"]
    },
    description: "æ¸©æš–ãªæ°—å€™ã¨ç¾ã—ã„æµ·ã€‚ç‹¬ç‰¹ã®æ–‡åŒ–"
  }
];

// è³ªå•é …ç›®ã®å®šç¾©
const questions = [
  {
    id: "budget",
    title: "æœˆã€…ã®å®¶è³ƒäºˆç®—ã¯ã©ã®ãã‚‰ã„ã§ã™ã‹ï¼Ÿ",
    options: [
      { value: "low", label: "5ä¸‡å††ä»¥ä¸‹", icon: "ğŸ’°" },
      { value: "medium", label: "5-10ä¸‡å††", icon: "ğŸ’µ" },
      { value: "high", label: "10ä¸‡å††ä»¥ä¸Šã§ã‚‚OK", icon: "ğŸ’´" }
    ]
  },
  {
    id: "climate",
    title: "ã©ã‚“ãªæ°—å€™ãŒãŠå¥½ã¿ã§ã™ã‹ï¼Ÿ",
    options: [
      { value: "warm", label: "æ¸©æš–ãªåœ°åŸŸ", icon: "â˜€ï¸" },
      { value: "moderate", label: "å››å­£ãŒã¯ã£ãã‚Š", icon: "ğŸ‚" },
      { value: "cold", label: "æ¶¼ã—ã„åœ°åŸŸ", icon: "â„ï¸" },
      { value: "snow", label: "é›ªãŒé™ã£ã¦ã‚‚æ§‹ã‚ãªã„", icon: "â›„" }
    ]
  },
  {
    id: "environment",
    title: "ã©ã‚“ãªç”Ÿæ´»ç’°å¢ƒã‚’å¸Œæœ›ã—ã¾ã™ã‹ï¼Ÿ",
    options: [
      { value: "large-city", label: "å¤§éƒ½å¸‚ï¼ˆä¾¿åˆ©ã•é‡è¦–ï¼‰", icon: "ğŸ™ï¸" },
      { value: "medium-city", label: "ä¸­è¦æ¨¡éƒ½å¸‚ï¼ˆãƒãƒ©ãƒ³ã‚¹å‹ï¼‰", icon: "ğŸ˜ï¸" },
      { value: "nature-rich", label: "è‡ªç„¶è±Šã‹ãªåœ°åŸŸ", icon: "ğŸŒ²" }
    ]
  },
  {
    id: "international",
    title: "å¿…è¦ãªå›½éš›å¯¾å¿œã‚µãƒ¼ãƒ“ã‚¹ã¯ï¼Ÿ",
    options: [
      { value: "foreign-community", label: "å¤–å›½äººã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£", icon: "ğŸŒ" },
      { value: "multilingual-medical", label: "å¤šè¨€èªå¯¾å¿œåŒ»ç™‚æ©Ÿé–¢", icon: "ğŸ¥" },
      { value: "international-school", label: "ã‚¤ãƒ³ã‚¿ãƒ¼ãƒŠã‚·ãƒ§ãƒŠãƒ«ã‚¹ã‚¯ãƒ¼ãƒ«", icon: "ğŸ’" }
    ]
  },
  {
    id: "access",
    title: "ã‚¢ã‚¯ã‚»ã‚¹ã§é‡è¦–ã™ã‚‹ç‚¹ã¯ï¼Ÿ",
    options: [
      { value: "airport-close", label: "å›½éš›ç©ºæ¸¯ã«è¿‘ã„", icon: "âœˆï¸" },
      { value: "tokyo-access", label: "æ±äº¬ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹", icon: "ğŸš„" },
      { value: "public-transport", label: "å…¬å…±äº¤é€šæ©Ÿé–¢ãŒå……å®Ÿ", icon: "ğŸš‡" }
    ]
  }
];

// æ—¢å­˜ã®åœ°åŸŸãƒ‡ãƒ¼ã‚¿ï¼ˆéƒ½é“åºœçœŒé¸æŠç”¨ï¼‰
const regions = [
  {
    name: "åŒ—æµ·é“åœ°æ–¹",
    image: `${import.meta.env.BASE_URL}assets/images/regions/åŒ—æµ·é“åœ°æ–¹.png`,
    prefectures: [
      { 
        name: "åŒ—æµ·é“", 
        slug: "hokkaido",
        image: `${import.meta.env.BASE_URL}assets/images/prefectures/hokkaido.png`,
        description: "åºƒå¤§ãªè‡ªç„¶ã¨å†¬ã®ãƒªã‚¾ãƒ¼ãƒˆåœ°",
        cities: ["æœ­å¹Œå¸‚", "æ—­å·å¸‚", "å‡½é¤¨å¸‚", "å°æ¨½å¸‚", "å¸¯åºƒå¸‚", "å®¤è˜­å¸‚", "å²©è¦‹æ²¢å¸‚", "è‹«å°ç‰§å¸‚", "é‡§è·¯å¸‚"]
      }
    ]
  },
  {
    name: "é–¢æ±åœ°æ–¹",
    image: `${import.meta.env.BASE_URL}assets/images/regions/é–¢æ±åœ°æ–¹.png`,
    prefectures: [
      { 
        name: "æ±äº¬éƒ½", 
        slug: "tokyo",
        image: `${import.meta.env.BASE_URL}assets/images/prefectures/tokyo.png`,
        description: "æ—¥æœ¬ã®é¦–éƒ½ã€‚ãƒ“ã‚¸ãƒã‚¹ã¨æ–‡åŒ–ã®ä¸­å¿ƒåœ°",
        cities: ["æ­¦è”µé‡å¸‚", "å›½ç«‹å¸‚", "æ¸‹è°·åŒº", "æ¸¯åŒº", "ä¸–ç”°è°·åŒº", "æ–°å®¿åŒº", "ç·´é¦¬åŒº", "å¤§ç”°åŒº", "æ–‡äº¬åŒº", "å…«ç‹å­å¸‚", "æ±Ÿæ±åŒº", "ç”ºç”°å¸‚", "æ‰ä¸¦åŒº", "è±Šå³¶åŒº"]
      }
    ]
  }
];
---

<BaseLayout {title} {description} {lang}>
  <!-- Hero Section -->
  <section class="relative bg-gradient-to-br from-blue-900 via-blue-800 to-indigo-900 overflow-hidden">
    <div class="absolute inset-0 opacity-10">
      <div class="absolute top-20 left-20 w-32 h-32 border border-white rounded-full"></div>
      <div class="absolute top-40 right-32 w-24 h-24 border border-white rounded-full"></div>
      <div class="absolute bottom-32 left-40 w-20 h-20 border border-white rounded-full"></div>
    </div>
    
    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20 lg:py-32 text-center text-white">
      <div class="mb-8">
        <span class="inline-flex items-center px-6 py-3 rounded-full text-sm font-semibold bg-white/20 backdrop-blur-sm border border-white/30">
          ğŸ  å¤–å›½äººã®ãŸã‚ã®åœ°åŸŸåˆ¥æš®ã‚‰ã—æƒ…å ±
        </span>
      </div>
      
      <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-6 leading-tight">
        æ—¥æœ¬ã§<span class="text-yellow-300">æš®ã‚‰ã™</span><br>
        <span class="text-lg md:text-xl font-normal opacity-90">ã‚ãªãŸã«æœ€é©ãªåœ°åŸŸã‚’è¦‹ã¤ã‘ã‚ˆã†</span>
      </h1>
      
      <p class="text-xl md:text-2xl mb-12 opacity-95 max-w-4xl mx-auto leading-relaxed">
        å¤–å›½äººãŒæ—¥æœ¬ã§å®‰å¿ƒã—ã¦æš®ã‚‰ã›ã‚‹ã‚ˆã†ã€å„åœ°åŸŸã®ç”Ÿæ´»æƒ…å ±ã‚’è©³ã—ãè§£èª¬ã€‚<br class="hidden md:block">
        é˜²ç½ãƒ»ã‚¤ãƒ³ãƒ•ãƒ©ãƒ»ç”Ÿæ´»ã‚³ã‚¹ãƒˆãƒ»æ³•åˆ¶åº¦ã¾ã§ã€å±…ä½è€…è¦–ç‚¹ã§å¾¹åº•èª¿æŸ»ã—ã¦ã„ã¾ã™ã€‚
      </p>
      
      <!-- Selection Buttons -->
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <button 
          id="prefecture-mode-btn"
          class="mode-btn inline-flex items-center px-8 py-4 bg-yellow-400 text-blue-900 font-bold text-lg rounded-full hover:bg-yellow-300 transition-all duration-300 shadow-xl"
          data-mode="prefecture"
        >
          <span class="mr-3">ğŸ“</span>
          éƒ½é“åºœçœŒã‹ã‚‰é¸ã¶
        </button>
        <button 
          id="quiz-mode-btn"
          class="mode-btn inline-flex items-center px-8 py-4 bg-white/20 backdrop-blur-sm text-white font-semibold text-lg rounded-full border border-white/30 hover:bg-white/30 transition-all duration-300"
          data-mode="quiz"
        >
          <span class="mr-3">ğŸ¯</span>
          è³ªå•ã«ç­”ãˆã¦æ¢ã™
        </button>
      </div>
    </div>
  </section>

  <!-- Prefecture Mode (default visible) -->
  <section id="prefecture-mode" class="mode-content py-16 lg:py-24 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
          éƒ½é“åºœçœŒã‚’é¸ã‚“ã§<span class="text-blue-600">è©³ã—ã„æƒ…å ±ã‚’è¦‹ã‚‹</span>
        </h2>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto">
          éƒ½é“åºœçœŒã‚’é¸æŠã™ã‚‹ã¨ã€ãã®åœ°åŸŸã®å¸‚åŒºç”ºæ‘æƒ…å ±ã‚’ã”è¦§ã„ãŸã ã‘ã¾ã™
        </p>
      </div>

      <div class="space-y-16">
        {regions.map((region) => (
          <div class="mb-16">
            <div class="flex items-center justify-center mb-8">
              <img 
                src={region.image}
                alt={region.name}
                class="w-8 h-8 mr-3 object-contain"
                width="32"
                height="32"
                loading="lazy"
                decoding="async"
              />
              <h3 class="text-2xl font-bold text-gray-900">{region.name}</h3>
            </div>
            
            <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
              {region.prefectures.map((prefecture) => (
                <a href={`${import.meta.env.BASE_URL}ja/blog/${prefecture.slug}/`} class="group">
                  <div class="bg-white rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1">
                    <div class="relative h-48 overflow-hidden bg-gray-100">
                      <LazyImage
                        src={prefecture.image}
                        alt={prefecture.name}
                        width={384}
                        height={192}
                        class="relative w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"
                        placeholder="blur"
                      />
                      <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent pointer-events-none"></div>
                      <div class="absolute bottom-4 left-4 text-white pointer-events-none">
                        <h4 class="text-xl font-bold mb-1">{prefecture.name}</h4>
                        <p class="text-sm opacity-90">{prefecture.description}</p>
                      </div>
                    </div>
                    
                    <div class="p-4">
                      <div class="flex items-center justify-between">
                        <p class="text-sm text-gray-600">
                          {prefecture.cities.length}ã®å¸‚åŒºç”ºæ‘
                        </p>
                        <span class="text-sm text-blue-600 font-medium">
                          è©³ç´°ã‚’è¦‹ã‚‹ â†’
                        </span>
                      </div>
                    </div>
                  </div>
                </a>
              ))}
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Quiz Mode (hidden by default) -->
  <section id="quiz-mode" class="mode-content hidden py-16 lg:py-24 bg-gray-50">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
          ã‚ãªãŸã«<span class="text-blue-600">ã´ã£ãŸã‚Šã®è¡—</span>ã‚’è¦‹ã¤ã‘ã¾ã—ã‚‡ã†
        </h2>
        <p class="text-xl text-gray-600">
          ã„ãã¤ã‹ã®è³ªå•ã«ç­”ãˆã‚‹ã¨ã€ãŠã™ã™ã‚ã®å¸‚åŒºç”ºæ‘ã‚’ã”ææ¡ˆã—ã¾ã™
        </p>
      </div>

      <!-- Questions Container -->
      <div id="questions-container" class="space-y-8 mb-12">
        {questions.map((question, index) => (
          <div class="bg-white rounded-xl shadow-lg p-8" data-question={question.id}>
            <div class="mb-6">
              <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800 mb-3">
                è³ªå• {index + 1} / {questions.length}
              </span>
              <h3 class="text-xl font-bold text-gray-900">{question.title}</h3>
            </div>
            
            <div class="grid gap-3 sm:grid-cols-2">
              {question.options.map((option) => (
                <label class="flex items-center p-4 border-2 border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all cursor-pointer">
                  <input 
                    type="checkbox" 
                    name={question.id}
                    value={option.value}
                    class="quiz-checkbox mr-3 w-5 h-5 text-blue-600 rounded focus:ring-blue-500"
                  />
                  <span class="text-2xl mr-3">{option.icon}</span>
                  <span class="text-gray-700">{option.label}</span>
                </label>
              ))}
            </div>
          </div>
        ))}
      </div>

      <!-- Submit Button -->
      <div class="text-center">
        <button 
          id="show-recommendations"
          class="inline-flex items-center px-12 py-4 bg-blue-600 text-white font-bold text-lg rounded-full hover:bg-blue-700 transition-all duration-300 shadow-xl disabled:bg-gray-400 disabled:cursor-not-allowed"
        >
          <span class="mr-3">ğŸ”</span>
          ãŠã™ã™ã‚ã‚’è¡¨ç¤º
        </button>
      </div>

      <!-- Results Container -->
      <div id="results-container" class="hidden mt-16">
        <div class="text-center mb-8">
          <h3 class="text-2xl font-bold text-gray-900 mb-2">
            ã‚ãªãŸã«ãŠã™ã™ã‚ã®<span class="text-blue-600">å¸‚åŒºç”ºæ‘</span>
          </h3>
          <p class="text-gray-600">é¸æŠã—ãŸæ¡ä»¶ã«åŸºã¥ã„ãŸãŠã™ã™ã‚é †ã«è¡¨ç¤ºã—ã¦ã„ã¾ã™</p>
        </div>
        
        <div id="recommendations-list" class="space-y-6">
          <!-- Results will be inserted here by JavaScript -->
        </div>
        
        <div class="text-center mt-8">
          <button 
            id="reset-quiz"
            class="inline-flex items-center px-8 py-3 bg-gray-200 text-gray-700 font-medium rounded-full hover:bg-gray-300 transition-all duration-300"
          >
            <span class="mr-2">â†º</span>
            ã‚‚ã†ä¸€åº¦è©¦ã™
          </button>
        </div>
      </div>
    </div>
  </section>

  <script define:vars={{ citiesData }}>
    // ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
    const modeBtns = document.querySelectorAll('.mode-btn');
    const modeContents = document.querySelectorAll('.mode-content');
    
    modeBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const mode = btn.dataset.mode;
        
        // ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«åˆ‡ã‚Šæ›¿ãˆ
        modeBtns.forEach(b => {
          if (b.dataset.mode === mode) {
            b.classList.add('bg-yellow-400', 'text-blue-900');
            b.classList.remove('bg-white/20', 'text-white');
          } else {
            b.classList.remove('bg-yellow-400', 'text-blue-900');
            b.classList.add('bg-white/20', 'text-white');
          }
        });
        
        // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        modeContents.forEach(content => {
          if (content.id === `${mode}-mode`) {
            content.classList.remove('hidden');
          } else {
            content.classList.add('hidden');
          }
        });
      });
    });
    
    // ã‚¯ã‚¤ã‚ºæ©Ÿèƒ½
    const showRecommendationsBtn = document.getElementById('show-recommendations');
    const resultsContainer = document.getElementById('results-container');
    const recommendationsList = document.getElementById('recommendations-list');
    const resetQuizBtn = document.getElementById('reset-quiz');
    const checkboxes = document.querySelectorAll('.quiz-checkbox');
    
    // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®å¤‰æ›´ã‚’ç›£è¦–
    checkboxes.forEach(checkbox => {
      checkbox.addEventListener('change', () => {
        const checkedCount = document.querySelectorAll('.quiz-checkbox:checked').length;
        showRecommendationsBtn.disabled = checkedCount === 0;
      });
    });
    
    // ãŠã™ã™ã‚è¡¨ç¤º
    showRecommendationsBtn.addEventListener('click', () => {
      const selectedValues = {};
      
      // é¸æŠã•ã‚ŒãŸå€¤ã‚’åé›†
      checkboxes.forEach(checkbox => {
        if (checkbox.checked) {
          const questionId = checkbox.name;
          if (!selectedValues[questionId]) {
            selectedValues[questionId] = [];
          }
          selectedValues[questionId].push(checkbox.value);
        }
      });
      
      // å„éƒ½å¸‚ã®ã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
      const cityScores = citiesData.map(city => {
        let score = 0;
        let matches = [];
        
        Object.entries(selectedValues).forEach(([category, values]) => {
          const cityValues = city.attributes[category] || [];
          const matchingValues = values.filter(v => cityValues.includes(v));
          
          if (matchingValues.length > 0) {
            score += matchingValues.length;
            matches.push({ category, values: matchingValues });
          }
        });
        
        return { ...city, score, matches, percentage: Math.round((score / Object.keys(selectedValues).length) * 100) };
      });
      
      // ã‚¹ã‚³ã‚¢é †ã«ã‚½ãƒ¼ãƒˆ
      cityScores.sort((a, b) => b.score - a.score);
      
      // çµæœã‚’è¡¨ç¤º
      recommendationsList.innerHTML = cityScores
        .filter(city => city.score > 0)
        .map((city, index) => `
          <div class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-all duration-300">
            <div class="flex flex-col md:flex-row">
              <div class="md:w-1/3 h-48 md:h-auto overflow-hidden">
                <img 
                  src="${city.image}"
                  alt="${city.name}"
                  class="w-full h-full object-cover"
                  loading="lazy"
                />
              </div>
              <div class="flex-1 p-6">
                <div class="flex items-start justify-between mb-4">
                  <div>
                    <h4 class="text-xl font-bold text-gray-900 mb-1">${city.name}</h4>
                    <p class="text-gray-600">${city.prefecture}</p>
                  </div>
                  <div class="text-right">
                    <div class="text-2xl font-bold text-blue-600">${city.percentage}%</div>
                    <div class="text-sm text-gray-500">ãƒãƒƒãƒåº¦</div>
                  </div>
                </div>
                
                <p class="text-gray-700 mb-4">${city.description}</p>
                
                <div class="mb-4">
                  <p class="text-sm font-medium text-gray-600 mb-2">ãƒãƒƒãƒã—ãŸæ¡ä»¶ï¼š</p>
                  <div class="flex flex-wrap gap-2">
                    ${city.matches.map(match => {
                      const categoryLabels = {
                        budget: { low: "ä½äºˆç®—", medium: "ä¸­äºˆç®—", high: "é«˜äºˆç®—OK" },
                        climate: { warm: "æ¸©æš–", moderate: "å››å­£", cold: "æ¶¼ã—ã„", snow: "é›ªOK" },
                        environment: { "large-city": "å¤§éƒ½å¸‚", "medium-city": "ä¸­è¦æ¨¡éƒ½å¸‚", "nature-rich": "è‡ªç„¶è±Šã‹" },
                        international: { "foreign-community": "å¤–å›½äººã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£", "multilingual-medical": "å¤šè¨€èªåŒ»ç™‚", "international-school": "ã‚¤ãƒ³ã‚¿ãƒ¼ãƒŠã‚·ãƒ§ãƒŠãƒ«ã‚¹ã‚¯ãƒ¼ãƒ«" },
                        access: { "airport-close": "ç©ºæ¸¯è¿‘ã„", "tokyo-access": "æ±äº¬ã‚¢ã‚¯ã‚»ã‚¹", "public-transport": "å…¬å…±äº¤é€šå……å®Ÿ" }
                      };
                      
                      return match.values.map(v => `
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                          ${categoryLabels[match.category][v]}
                        </span>
                      `).join('');
                    }).join('')}
                  </div>
                </div>
                
                <a 
                  href="${import.meta.env.BASE_URL}ja/blog/${city.prefectureSlug}/${city.citySlug}/"
                  class="inline-flex items-center text-blue-600 hover:text-blue-700 font-medium"
                >
                  è©³ã—ãè¦‹ã‚‹
                  <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                </a>
              </div>
            </div>
          </div>
        `).join('') || '<p class="text-center text-gray-600">æ¡ä»¶ã«åˆã†å¸‚åŒºç”ºæ‘ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚åˆ¥ã®æ¡ä»¶ã§ãŠè©¦ã—ãã ã•ã„ã€‚</p>';
      
      // çµæœã‚’è¡¨ç¤ºã—ã€è³ªå•ã‚’éš ã™
      document.getElementById('questions-container').classList.add('hidden');
      showRecommendationsBtn.classList.add('hidden');
      resultsContainer.classList.remove('hidden');
      
      // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
      resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });
    
    // ãƒªã‚»ãƒƒãƒˆ
    resetQuizBtn.addEventListener('click', () => {
      checkboxes.forEach(checkbox => checkbox.checked = false);
      showRecommendationsBtn.disabled = true;
      resultsContainer.classList.add('hidden');
      document.getElementById('questions-container').classList.remove('hidden');
      showRecommendationsBtn.classList.remove('hidden');
      
      // ä¸Šéƒ¨ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
      document.getElementById('quiz-mode').scrollIntoView({ behavior: 'smooth', block: 'start' });
    });
  </script>
</BaseLayout>